<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ওয়েব ব্যাটেল রয়্যাল</title>
    <style>
        body {
            background-color: #1a1a1a;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        canvas {
            border: 2px solid #fff;
            background-color: #3d3d3d;
            cursor: crosshair;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 18px;
        }
    </style>
</head>
<body>

    <div id="info">
        <div>স্বাস্থ্য: <span id="health">100</span></div>
        <div>স্কোর: <span id="score">0</span></div>
    </div>

    <canvas id="gameCanvas" width="900" height="600"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // --- গেমের অবস্থা (Game State) ---
        let gameOver = false;
        let score = 0;

        // --- প্লেয়ার ---
        const player = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            width: 30,
            height: 30,
            speed: 5,
            health: 100,
            color: '#00ff00' // সবুজ রঙ
        };

        // --- ইনপুট হ্যান্ডলিং (কিবোর্ড ও মাউস) ---
        const keys = {};
        let mouseX = 0, mouseY = 0;

        document.addEventListener('keydown', (e) => keys[e.key.toLowerCase()] = true);
        document.addEventListener('keyup', (e) => keys[e.key.toLowerCase()] = false);
        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            mouseX = e.clientX - rect.left;
            mouseY = e.clientY - rect.top;
        });

        // --- গুলি (Bullets) ---
        const bullets = [];
        class Bullet {
            constructor(x, y, angle) {
                this.x = x;
                this.y = y;
                this.width = 5;
                this.height = 5;
                this.speed = 10;
                this.angle = angle;
                this.dx = Math.cos(angle) * this.speed;
                this.dy = Math.sin(angle) * this.speed;
                this.color = '#ffff00'; // হলুদ রঙ
            }
            update() {
                this.x += this.dx;
                this.y += this.dy;
            }
            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x - this.width / 2, this.y - this.height / 2, this.width, this.height);
            }
            isOffScreen() {
                return this.x < 0 || this.x > canvas.width || this.y < 0 || this.y > canvas.height;
            }
        }

        // --- শত্রু (Enemies) ---
        const enemies = [];
        class Enemy {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = 25;
                this.height = 25;
                this.speed = 1.5;
                this.health = 30;
                this.color = '#ff0000'; // লাল রঙ
            }
            update() {
                // সহজ AI: শত্রু সরাসরি প্লেয়ারের দিকে যায়
                const angle = Math.atan2(player.y - this.y, player.x - this.x);
                this.x += Math.cos(angle) * this.speed;
                this.y += Math.sin(angle) * this.speed;
            }
            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x - this.width / 2, this.y - this.height / 2, this.width, this.height);
                // স্বাস্থ্য বার
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(this.x - this.width / 2, this.y - this.height / 2 - 10, this.width, 3);
                ctx.fillStyle = '#ff0000';
                ctx.fillRect(this.x - this.width / 2, this.y - this.height / 2 - 10, this.width * (this.health / 30), 3);
            }
            takeDamage(damage) {
                this.health -= damage;
            }
        }

        // --- বাড়িঘর (Buildings) ---
        const buildings = [
            { x: 100, y: 100, width: 150, height: 100, color: '#8B4513' }, // বাদামী রঙ
            { x: 650, y: 400, width: 200, height: 150, color: '#696969' }, // ধূসর রঙ
            { x: 400, y: 50, width: 100, height: 120, color: '#8B4513' },
            { x: 50, y: 450, width: 120, height: 100, color: '#696969' }
        ];

        // --- মাটিতে পড়ে থাকা অস্ত্র (Guns on Ground) ---
        const guns = [
            { x: 150, y: 150, width: 20, height: 10, color: '#ffa500', name: 'Pistol' }, // কমলা রঙ
            { x: 700, y: 450, width: 25, height: 12, color: '#ff00ff', name: 'Rifle' } // ম্যাজেন্টা রঙ
        ];

        // --- কলিশন ডিটেকশন (Collision Detection) ---
        function rectCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        // --- গেম লজিক ---
        function updatePlayer() {
            let dx = 0;
            let dy = 0;
            if (keys['w'] || keys['arrowup']) dy = -player.speed;
            if (keys['s'] || keys['arrowdown']) dy = player.speed;
            if (keys['a'] || keys['arrowleft']) dx = -player.speed;
            if (keys['d'] || keys['arrowright']) dx = player.speed;

            const nextX = player.x + dx;
            const nextY = player.y + dy;

            // বাড়িঘরের সাথে কলিশন চেক
            let canMove = true;
            const futurePlayer = { x: nextX - player.width / 2, y: nextY - player.height / 2, width: player.width, height: player.height };
            for (const building of buildings) {
                if (rectCollision(futurePlayer, building)) {
                    canMove = false;
                    break;
                }
            }

            if (canMove) {
                player.x = nextX;
                player.y = nextY;
            }
            
            // ক্যানভাসের বাইরে যেতে না দেওয়া
            player.x = Math.max(player.width / 2, Math.min(canvas.width - player.width / 2, player.x));
            player.y = Math.max(player.height / 2, Math.min(canvas.height - player.height / 2, player.y));
        }

        function shoot() {
            if (gameOver) return;
            const angle = Math.atan2(mouseY - player.y, mouseX - player.x);
            bullets.push(new Bullet(player.x, player.y, angle));
        }
        canvas.addEventListener('click', shoot);

        function spawnEnemy() {
            if (gameOver) return;
            const side = Math.floor(Math.random() * 4);
            let x, y;
            if (side === 0) { x = Math.random() * canvas.width; y = -30; }
            else if (side === 1) { x = canvas.width + 30; y = Math.random() * canvas.height; }
            else if (side === 2) { x = Math.random() * canvas.width; y = canvas.height + 30; }
            else { x = -30; y = Math.random() * canvas.height; }
            enemies.push(new Enemy(x, y));
        }
        setInterval(spawnEnemy, 2000); // প্রতি ২ সেকেন্ডে একটি শত্রু আসবে

        // --- ড্রয়িং ফাংশন ---
        function draw() {
            // ক্যানভাস পরিষ্কার
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // বাড়িঘর আঁকা
            ctx.fillStyle = '#8B4513'; // একটা ডিফল্ট রঙ
            for (const building of buildings) {
                ctx.fillStyle = building.color;
                ctx.fillRect(building.x, building.y, building.width, building.height);
            }

            // মাটিতে পড়ে থাকা অস্ত্র আঁকা
            for (const gun of guns) {
                ctx.fillStyle = gun.color;
                ctx.fillRect(gun.x - gun.width / 2, gun.y - gun.height / 2, gun.width, gun.height);
            }

            // প্লেয়ার আঁকা
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x - player.width / 2, player.y - player.height / 2, player.width, player.height);
            
            // প্লেয়ারের দিকে একটি লাইন আঁকা (আইমিং এর জন্য)
            ctx.strokeStyle = 'white';
            ctx.beginPath();
            ctx.moveTo(player.x, player.y);
            const aimLength = 50;
            const angle = Math.atan2(mouseY - player.y, mouseX - player.x);
            ctx.lineTo(player.x + Math.cos(angle) * aimLength, player.y + Math.sin(angle) * aimLength);
            ctx.stroke();


            // শত্রু আঁকা
            for (const enemy of enemies) {
                enemy.draw();
            }

            // গুলি আঁকা
            for (const bullet of bullets) {
                bullet.draw();
            }

            // UI আপডেট
            document.getElementById('health').textContent = player.health;
            document.getElementById('score').textContent = score;

            // গেম ওভার স্ক্রিন
            if (gameOver) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '60px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('গেম ওভার!', canvas.width / 2, canvas.height / 2 - 30);
                ctx.font = '30px Arial';
                ctx.fillText(`আপনার স্কোর: ${score}`, canvas.width / 2, canvas.height / 2 + 20);
            }
        }

        // --- মূল গেম লুপ ---
        function gameLoop() {
            if (!gameOver) {
                updatePlayer();

                // গুলি আপডেট
                for (let i = bullets.length - 1; i >= 0; i--) {
                    bullets[i].update();
                    if (bullets[i].isOffScreen()) {
                        bullets.splice(i, 1);
                        continue;
                    }

                    // গুলি বনাম বাড়িঘর
                    let hitBuilding = false;
                    for (const building of buildings) {
                        if (rectCollision(bullets[i], building)) {
                            hitBuilding = true;
                            break;
                        }
                    }
                    if (hitBuilding) {
                        bullets.splice(i, 1);
                        continue;
                    }

                    // গুলি বনাম শত্রু
                    for (let j = enemies.length - 1; j >= 0; j--) {
                        if (rectCollision(bullets[i], enemies[j])) {
                            enemies[j].takeDamage(10);
                            bullets.splice(i, 1);
                            if (enemies[j].health <= 0) {
                                enemies.splice(j, 1);
                                score += 10;
                            }
                            break;
                        }
                    }
                }

                // শত্রু আপডেট
                for (const enemy of enemies) {
                    enemy.update();
                    // শত্রু বনাম প্লেয়ার
                    if (rectCollision(enemy, player)) {
                        player.health -= 1;
                        if (player.health <= 0) {
                            gameOver = true;
                        }
                    }
                }
            }

            draw();
            requestAnimationFrame(gameLoop);
        }

        // --- গেম শুরু ---
        gameLoop();

    </script>
</body>
</html>